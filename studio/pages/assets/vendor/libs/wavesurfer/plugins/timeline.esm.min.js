class t{constructor(){this.listeners={}}on(t,e,i){if(this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(e),null!=i&&i.once){const i=()=>{this.un(t,i),this.un(t,e)};return this.on(t,i),i}return()=>this.un(t,e)}un(t,e){null!=(t=this.listeners[t])&&t.delete(e)}once(t,e){return this.on(t,e,{once:!0})}unAll(){this.listeners={}}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach(t=>t(...e))}}class e extends t{constructor(t){super(),this.subscriptions=[],this.options=t}onInit(){}_init(t){this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(t=>t())}}function i(t,e){const n=e.xmlns?document.createElementNS(e.xmlns,t):document.createElement(t);for(const[t,s]of Object.entries(e))if("children"===t)for(const[t,o]of Object.entries(e))"string"==typeof o?n.appendChild(document.createTextNode(o)):n.appendChild(i(t,o));else"style"===t?Object.assign(n.style,s):"textContent"===t?n.textContent=s:n.setAttribute(t,s.toString());return n}function n(t,e,n){return i(t,e||{})}const s={height:20,formatTimeCallback:t=>1<t/60?Math.floor(t/60)+":"+((t=Math.round(t%60))<10?"0":"")+t:""+Math.round(1e3*t)/1e3};class o extends e{constructor(t){super(t||{}),this.options=Object.assign({},s,t),this.timelineWrapper=this.initTimelineWrapper()}static create(t){return new o(t)}onInit(){var t;if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");let e=this.wavesurfer.getWrapper();if(this.options.container instanceof HTMLElement)e=this.options.container;else if("string"==typeof this.options.container){const t=document.querySelector(this.options.container);if(!t)throw Error("No Timeline container found matching "+this.options.container);e=t}this.options.insertPosition?(e.firstElementChild||e).insertAdjacentElement(this.options.insertPosition,this.timelineWrapper):e.appendChild(this.timelineWrapper),this.subscriptions.push(this.wavesurfer.on("redraw",()=>this.initTimeline())),(null!=(t=this.wavesurfer)&&t.getDuration()||this.options.duration)&&this.initTimeline()}destroy(){this.timelineWrapper.remove(),super.destroy()}initTimelineWrapper(){return n("div",{part:"timeline-wrapper",style:{pointerEvents:"none"}})}defaultTimeInterval(t){return 25<=t?1:25<=5*t?5:25<=15*t?15:60*Math.ceil(.5/t)}defaultPrimaryLabelInterval(t){return 25<=t?10:25<=5*t?6:4}defaultSecondaryLabelInterval(t){return 25<=t?5:2}initTimeline(){var i,s,t,o;const r=null!=(o=null!=(t=null==(t=this.wavesurfer)?void 0:t.getDuration())?t:this.options.duration)?o:0,l=this.timelineWrapper.scrollWidth/r,a=null!=(i=this.options.timeInterval)?i:this.defaultTimeInterval(l),h=null!=(s=this.options.primaryLabelInterval)?s:this.defaultPrimaryLabelInterval(l),p=this.options.primaryLabelSpacing,c=null!=(t=this.options.secondaryLabelInterval)?t:this.defaultSecondaryLabelInterval(l),u=this.options.secondaryLabelSpacing,e="beforebegin"===this.options.insertPosition,d=n("div",{style:Object.assign({height:this.options.height+"px",overflow:"hidden",fontSize:this.options.height/2+"px",whiteSpace:"nowrap"},e?{position:"absolute",top:"0",left:"0",right:"0",zIndex:"2"}:{position:"relative"})}),f=(d.setAttribute("part","timeline"),"string"==typeof this.options.style?d.setAttribute("style",d.getAttribute("style")+this.options.style):"object"==typeof this.options.style&&Object.assign(d.style,this.options.style),n("div",{style:{width:"0",height:"50%",display:"flex",flexDirection:"column",justifyContent:e?"flex-start":"flex-end",top:e?"0":"auto",bottom:e?"auto":"0",overflow:"visible",borderLeft:"1px solid currentColor",opacity:""+(null!=(o=this.options.secondaryLabelOpacity)?o:.25),position:"absolute",zIndex:"1"}}));for(let t=0,e=0;t<r;t+=a,e++){const o=f.cloneNode(),n=Math.round(100*t)/100%h==0||p&&e%p==0,i=Math.round(100*t)/100%c==0||u&&e%u==0,s=((n||i)&&(o.style.height="100%",o.style.textIndent="3px",o.textContent=this.options.formatTimeCallback(t),n&&(o.style.opacity="1")),n?"primary":i?"secondary":"tick");o.setAttribute("part","timeline-notch timeline-notch-"+s),o.style.left=t*l+"px",d.appendChild(o)}this.timelineWrapper.innerHTML="",this.timelineWrapper.appendChild(d),this.emit("ready")}}export{o as default};